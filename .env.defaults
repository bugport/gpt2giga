# NOTE: Defaults reference file. Do NOT modify; copy keys to your .env to override.

# Proxy
GPT2GIGA_HOST=localhost               # Default bind host
GPT2GIGA_PORT=8090                    # Default HTTP port
GPT2GIGA_USE_HTTPS=False              # Proxy serves HTTP by default
GPT2GIGA_HTTPS_KEY_FILE=              # (HTTPS only) path to key
GPT2GIGA_HTTPS_CERT_FILE=             # (HTTPS only) path to cert
GPT2GIGA_LOG_LEVEL=INFO               # CRITICAL|ERROR|WARNING|INFO|DEBUG
GPT2GIGA_PASS_MODEL=False             # Do not pass client model by default
GPT2GIGA_PASS_TOKEN=False             # Do not forward Authorization by default
GPT2GIGA_EMBEDDINGS=EmbeddingsGigaR   # Embeddings model used on /embeddings
GPT2GIGA_ENABLE_IMAGES=True           # Enable images by default
GPT2GIGA_TIMEOUT=600                  # Proxy request timeout (sec)

# Streaming coalescing (disabled by default â†’ passthrough)
GPT2GIGA_STREAM_COALESCE_BYTES=0      # 0 disables byte-based coalescing
GPT2GIGA_STREAM_COALESCE_MS=0         # 0 disables time-based coalescing
GPT2GIGA_STREAM_ADAPTIVE=True         # Adaptive chunk sizing for streaming
GPT2GIGA_STREAM_TARGET_CHUNK_MS=100   # Target time between chunks
GPT2GIGA_STREAM_MIN_BYTES=256         # Min adaptive chunk size
GPT2GIGA_STREAM_MAX_BYTES=8192        # Max adaptive chunk size

# Backend (GigaChat-compatible)
GIGACHAT_BASE_URL=https://gigachat.devices.sberbank.ru/api/v1 # Default upstream
GIGACHAT_MODEL=GigaChat              # Default chat model
GIGACHAT_AUTH_URL=                   # Optional separate auth URL
GIGACHAT_SCOPE=                      # Optional scope
GIGACHAT_CREDENTIALS=                # Optional API key
GIGACHAT_USER=                       # Optional user (if used)
GIGACHAT_PASSWORD=                   # Optional password (if used)
GIGACHAT_ACCESS_TOKEN=               # Optional bearer/JWT
GIGACHAT_PROFANITY_CHECK=False       # Disabled by default
GIGACHAT_VERIFY_SSL_CERTS=True       # Verify TLS by default for HTTPS
GIGACHAT_CA_BUNDLE_FILE=             # Optional custom CA bundle
GIGACHAT_MTLS_AUTH=False             # mTLS disabled by default
GIGACHAT_CERT_FILE=                  # (mTLS) client cert
GIGACHAT_KEY_FILE=                   # (mTLS) client key
GIGACHAT_KEY_FILE_PASSWORD=          # (mTLS) key password
GIGACHAT_TIMEOUT=30                  # Backend timeout (sec)

# Proxy-managed OAuth/JWT acquisition (disabled by default)
GPT2GIGA_AUTH_TOKEN_URL=             # Token endpoint URL
GPT2GIGA_AUTH_BASIC_B64=             # base64(CLIENT_ID:CLIENT_SECRET)
GPT2GIGA_AUTH_GRANT_TYPE=client_credentials # Grant type (empty to omit)
GPT2GIGA_AUTH_SCOPE=                 # Optional scope
GPT2GIGA_AUTH_INSECURE=False         # Disable TLS verification for token fetch

# Embeddings limits config (array format JSON)
GPT2GIGA_EMBEDDINGS_CONFIG_FILE=     # Override path; default gpt2giga/config/embeddings.json

# Completions token limits config (array format JSON)
GPT2GIGA_COMPLETIONS_CONFIG_FILE=    # Override path; default gpt2giga/config/completions.json


# Embeddings adaptive retry/backoff
GPT2GIGA_EMBEDDINGS_MAX_RETRIES=3
GPT2GIGA_EMBEDDINGS_BACKOFF_BASE_MS=200
GPT2GIGA_EMBEDDINGS_BACKOFF_MAX_MS=5000
GPT2GIGA_EMBEDDINGS_RATE_MIN_MS=0
GPT2GIGA_EMBEDDINGS_RATE_MAX_MS=1000
GPT2GIGA_EMBEDDINGS_RATE_BACKOFF_FACTOR=2
GPT2GIGA_EMBEDDINGS_RATE_SUCCESS_WINDOW=10
GPT2GIGA_EMBEDDINGS_RATE_DROP_TO_AVG_AFTER=10
GPT2GIGA_EMBEDDINGS_RATE_MEDIAN_SAMPLES=21
GPT2GIGA_EMBEDDINGS_TIMEOUT_FACTOR=2
GPT2GIGA_EMBEDDINGS_TIMEOUT_MIN_MS=1000
GPT2GIGA_EMBEDDINGS_TIMEOUT_MAX_MS=60000
GPT2GIGA_EMBEDDINGS_TIMEOUT_MAX_RETRIES=0
GPT2GIGA_CLOSE_SOCKET_ON_TIMEOUT=false
GPT2GIGA_TIMEOUT_CLOSE_THRESHOLD=2

# Embeddings request queue (enabled by default)
GPT2GIGA_EMB_QUEUE_ENABLED=true
GPT2GIGA_EMB_QUEUE_SIZE=100
GPT2GIGA_EMB_WORKERS=2
GPT2GIGA_EMB_RATE_RPS=0

# Idle monitoring and pool management
IDLE_WARN_MS=30000             # Log idle warnings after this many ms
IDLE_CHECK_MS=5000            # How often to check for idle state
IDLE_CLOSE_POOL_MS=60000      # Close and restart pool after idle timeout

# Upstream HTTP connection pooling (shared defaults)
GPT2GIGA_HTTP2=false
GPT2GIGA_POOL_MAX_CONNECTIONS=100
GPT2GIGA_POOL_MAX_KEEPALIVE=20
GPT2GIGA_POOL_KEEPALIVE_TIMEOUT_MS=60000
GPT2GIGA_POOL_KEEPALIVE_EXPIRY_MS=5000

# Endpoint-specific connection pooling (separate TCP connections per endpoint)
GPT2GIGA_POOL_CHAT_MAX_CONNECTIONS=100    # Override for /chat/completions endpoint
GPT2GIGA_POOL_CHAT_MAX_KEEPALIVE=20       # Override for /chat/completions endpoint
GPT2GIGA_POOL_EMB_MAX_CONNECTIONS=10      # Override for /embeddings endpoint (smaller pool)
GPT2GIGA_POOL_EMB_MAX_KEEPALIVE=5        # Override for /embeddings endpoint (smaller keepalive)

# RAG (Retrieval-Augmented Generation) Configuration
GPT2GIGA_RAG_ENABLED=false                            # Enable RAG for chat completions (default: false)
GPT2GIGA_RAG_COLLECTION_NAME=                         # Vector DB collection name for RAG (default: from indexer or 'codebase')
GPT2GIGA_RAG_VECTOR_DB_TYPE=simple                    # Vector DB type: simple, qdrant (default: simple)
GPT2GIGA_RAG_VECTOR_DB_URL=                           # Vector DB URL (e.g., http://localhost:6333 for Qdrant)
GPT2GIGA_RAG_VECTOR_DB_API_KEY=                       # Vector DB API key (optional)
GPT2GIGA_RAG_TOP_K=5                                  # Number of top chunks to retrieve (default: 5)
GPT2GIGA_RAG_MIN_SIMILARITY=0.7                       # Minimum similarity threshold for retrieval (default: 0.7)

# Codebase Indexer Configuration
GPT2GIGA_INDEXER_GPT2GIGA_URL=http://localhost:8090  # gpt2giga API URL
GPT2GIGA_INDEXER_COLLECTION_NAME=                     # Vector DB collection (default: codebase)
GPT2GIGA_INDEXER_BATCH_SIZE=100                       # Batch size for embeddings
GPT2GIGA_INDEXER_CHUNK_SIZE=2000                       # Target tokens per chunk (increased from 1000 for better context)
GPT2GIGA_INDEXER_INCLUDE_PATTERNS=.py,.js,.ts,.java,.go,.rs,.cpp,.cc,.cxx,.c,.h,.hpp,.hxx,.sql  # File extensions to include (C++, SQL, and common languages)
GPT2GIGA_INDEXER_EXCLUDE_PATTERNS=node_modules,venv,.venv,.git,__pycache__,*.pyc  # Patterns to exclude
GPT2GIGA_INDEXER_INCREMENTAL=true                     # Only index changed files (default: true)
GPT2GIGA_INDEXER_VECTOR_DB_TYPE=simple                # Vector DB type: simple, qdrant
GPT2GIGA_INDEXER_VECTOR_DB_URL=                       # Vector DB URL (e.g., http://localhost:6333 for Qdrant)
GPT2GIGA_INDEXER_VECTOR_DB_API_KEY=                  # Vector DB API key (optional)

